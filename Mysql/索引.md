### 索引



**索引（index）是帮助MySQL高效获取数据的数据结构(有序)。在数据之外，数据库系统还维护着满足 特定查找算法的数据结构，这些数据结构以某种方式引用（指向）数据， 这样就可以在这些数据结构 上实现高级查找算法，这种数据结构就是索引。**



**在无索引情况下，就需要从第一行开始扫描，一直扫描到最后一行，我们称之为 全表扫描，性能很 低。**



**索引的优缺点**

![QQ截图20220506210051](E:\笔记整理\Mysql\图片\QQ截图20220506210051.png)



**MySQL的索引是在存储引擎层实现的，不同的存储引擎有不同的索引结构，主要包含以下几种：**



![QQ截图20220506210132](E:\笔记整理\Mysql\图片\QQ截图20220506210132.png)





**上述是MySQL中所支持的所有的索引结构，接下来，我们再来看看不同的存储引擎对于索引结构的支持情况**



**![QQ截图20220506210238](E:\笔记整理\Mysql\图片\QQ截图20220506210238.png)**



#### **二叉树**

**假如说MySQL的索引结构采用二叉树的数据结构，比较理想的结构如下：**

![QQ截图20220506204832](E:\笔记整理\Mysql\图片\QQ截图20220506204832.png)



**如果主键是顺序插入的，则会形成一个单向链表，结构如下**





![QQ截图20220506204908](E:\笔记整理\Mysql\图片\QQ截图20220506204908.png)



**所以，如果选择二叉树作为索引结构，会存在以下缺点： **

**1：顺序插入时，会形成一个链表，查询性能大大降低**

**2：大数据量情况下，层级较深，检索速度慢。**

**所以为了解决顺序插入的问题，我们引入了红黑树，最终形成的数据结构也是一颗平衡的二叉树**





#### **红黑树**

![QQ截图20220506205051](E:\笔记整理\Mysql\图片\QQ截图20220506205051.png)

**但是，即使如此，由于红黑树也是一颗二叉树，所以也会存在一个缺点： **

**大数据量情况下，层级较深，检索速度慢。**

**所以又引入了B树**





#### **B树**

**B树是一种多叉路衡查找树，相对于二叉树，B树每个节点可以有多个分支，即多叉。 **

**以一颗最大度数为5(5阶)的B树为例，那这个B树每个节点最多存储4个key，5 个指针：**



![QQ截图20220506205233](E:\笔记整理\Mysql\图片\QQ截图20220506205233.png)

**每次节点的数量达到最大的度的时候，就把中间的那个节点往上面移动**

**5阶的B树，每一个节点最多存储4个key，对应5个指针。 **

**一旦节点存储的key数量到达5，就会裂变，中间元素向上分裂。**

**在B树中，非叶子节点和叶子节点都会存放数据。**



**B＋树**

**B+Tree是B树的变种，我们以一颗最大度数（max-degree）为4（4阶）的b+tree为例，来看一 下其结构示意图：**

![QQ截图20220506205817](E:\笔记整理\Mysql\图片\QQ截图20220506205817.png)



**演示：https://www.cs.usfca.edu/~galles/visualization/BPlusTree.html**

**最终我们看到，B+Tree 与 B-Tree相比，主要有以下三点区别： **

**所有的数据都会出现在叶子节点。 叶子节点形成一个单向链表。 **

**非叶子节点仅仅起到索引数据作用，具体的数据都是在叶子节点存放的。**



**上述我们所看到的结构是标准的B+Tree的数据结构，接下来，我们再来看看MySQL中优化之后的 B+Tree。**

**MySQL索引数据结构对经典的B+Tree进行了优化。在原B+Tree的基础上，增加一个指向相邻叶子节点 的链表指针，就形成了带有顺序指针的B+Tree，提高区间访问的性能，利于排序。**![QQ截图20220506205904](E:\笔记整理\Mysql\图片\QQ截图20220506205904.png)





#### 哈希

**特点 **

**A. Hash索引只能用于对等比较(=，in)，不支持范围查询（between，>，< ，...） **

**B. 无法利用索引完成排序操作 **

**C. 查询效率高，通常(不存在hash冲突的情况)只需要一次检索就可以了，效率通常要高于B+tree索引**

**但是只有memory引擎支持**



**注意：在MySQL中，支持hash索引的是Memory存储引擎。 而InnoDB中具有自适应hash功能，hash索引是 InnoDB存储引擎根据B+Tree索引在指定条件下自动构建的。**





**思考题： 为什么InnoDB存储引擎选择使用B+tree索引结构?**

**A. 相对于二叉树，层级更少，搜索效率高；**

**B. 对于B树，无论是叶子节点还是非叶子节点，都会保存数据，这样导致一页中存储的键值减少，指针跟着减少，要同样保存大量数据，只能增加树的高度，导致性能降低；**

**C. 相对Hash索引，B+tree支持范围匹配及排序操作；**