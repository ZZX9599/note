### Redis的主从复制

**主从复制--读写分离 **

**通过持久化功能，Redis 保证了即使在服务器重启的情况下也不会丢失（或少量丢失） 数据，但是由于数据是存储在一台服务器上的，如果这台服务器出现故障，比如硬盘坏了， 也会导致数据丢失。 为了避免单点故障，我们需要将数据复制多份部署在多台不同的服务器上，即使有一台 服务器出现故障其他服务器依然可以继续提供服务。 这就要求当一台服务器上的数据更新后，自动将更新的数据同步到其他服务器上，那该 怎么实现呢？Redis 的主从复制。**



**Redis 提供了复制（replication）功能来自动实现多台 redis 服务器的数据同步**

**我们可以通过部署多台 redis，并在配置文件中指定这几台 redis 之间的主从关系，主redis负责写入数据，同时把写入的数据实时同步到从机器，这种模式叫做主从复制，即 master/slave，并且 redis 默认 master 用于写，slave 用于读，向 slave 写数据会导致错误**



**主要是为了达到读写分离的效果**



### **模拟搭建一主二从的服务器**

**注意：搭建主从服务器的时候，只配置从库，不配置主库**

**拷贝三份redis的主配置文件，分别更改端口为6381  6382  6383  修改三个文件的pid文件名，日志文件名，rdb文件名**

**分别开启三个服务端，开启redis**

**配置主从关系的时候。并不是在redis主服务器里面指定子redis，而是在子redis里面指定主redis的ip和端口**



**配置方式一：在子redis的配置文件里面配置slaveof   ip   port**

**可以配置从属于哪个服务器**



**配置方式二：在需要配置的从服务器客端 执行slaveof   ip  port**



**注意：如果主redis设置了密码，从库的redis.conf中还需要设置masterauth为主redis的密码。**



### 如何查看从属的服务器

**查看服务器信息：info replication**

**查看全部信息：info**



**在master里面执行的时候，会显示角色和slave的情况**

**同理：在slave里面执行的时候，会显示自己从属于哪个mastre**



**执行测试，发现只有主redis可以写入数据，从机只能读取数据，不能写入数据**

