### Redis主从机故障

**当 Master 服务出现故障，从机不会执行任何操作，原地待命。主机宕机后恢复正常**

**所以如果主机宕机，还没修复的阶段。需手动将 slave 中的一个提升为 master，剩下的 slave 挂至新的 master 上**

**假设6379之前是主机  宕机了  之前的从机是6380,6381,6382 **

**①：slaveof no one，将一台 slave 服务器提升为 Master （提升某 slave 为 master） **

**注意：这个时候是没有从机的，虽然自己是master**



**②：slaveof 127.0.0.1 6380 （将 6380slave 挂至新的 master 上）**



**第三步：将其他 Slave 挂到新的 Master    slaveof  ip  port**



**这个时候，曾经redis服务恢复。不会再成为这个主从关系的master了，如果在之前没有执行slaveof no one的话。曾经的redis就会继续做这个主从关系的master**



**注意：这个时候，恢复最开始的redis服务，他依然是master，不过不属于这个主从关系了，如果需要加入这个主从关系的话，还是需要slaveof ip port**





**正常的redis主从关系中。从机突然宕机了。这个时候主机查看情况  info  replication**

**会发现从机数量少了1**

**其他从机正常工作**

**从机宕机后恢复：仍然是主机，不过不属于这个主从关系里面了，要想加入这个关系，就要重新设置主从关系**



**a的从机有b,c   b的从机有e,f   c的从机有g,h   这个时候a写入数据    bcedfgh都会添加数据**

**一台主机配多台从机，一台从机再配多台从机，从而实现了庞大的集群架构。同时也减轻了一台主机的压力，缺点是增加了服务器间的延迟。**



**1、一个 master 可以有多个 slave **

**2、slave 下线，读请求的处理性能下降 **

**3、master 下线，写请求无法执行 **

**4、当 master 发生故障，需手动将其中一台 slave 使用 slaveof no one 命令提升为 master，其 它 slave 执行 slaveof 命令指向这个新的 master，从新的 master 处同步数据 **

**5、主从复制模式的故障转移需要手动操作，要实现自动化处理，这就需要 Sentinel 哨兵， 实现故障自动转移**

