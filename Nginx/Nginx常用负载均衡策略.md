### Nginx常用负载均衡策略



#### 1：轮询策略

**默认是轮询策略：挨着来，一个一次**

**但是这种方式要求配置的多个服务器性能基本一致，性能差的可能会宕机**

**如果有服务器宕机，Nginx会把宕机的机器剔除，不再发送请求到这个服务器上面**



#### 2：权重策略

**按照机器的不同性能来分配请求到服务器**

**性能好的机器，请求分配多，性能差的分配少**

**每个请求按一定比例分发到不同的后端服务器，weight值越大访问的比例越大，用于后端服务器性能不均的情况**

**upstream crm {** 

​       **server 192.168.0.14 weight=5;** 

​       **server 192.168.0.15 weight=2;** 

**}** 

**如果有七个请求，两个分配给192.168.0.15     五个分配给192.168.0.14**



#### 3：最少请求

**web请求会被转发到连接数最少的服务器上**

**upstream crm {** 

​       **least_conn;**

​       **server 127.0.0.1:8080;** 

​       **server 127.0.0.1:9090;** 

**}**    

**谁不忙，就分配给谁**



#### 以上三种方式都有一个共同特点，会切换服务器，会导致session丢失！因为session在服务器里面，换了服务器，会丢失session



#### 4:ip-hash

**ip_hash也叫IP绑定，每个请求按访问ip的hash值分配**

**这样每个访问客户端会固定访问一个后端服务器，可以解决会话Session丢失的问题**

**ip不变的情况下，每次都是一个ip，取模都是相同结果，都是一台服务器**



**但是ip可能会变，也可能换服务器，也可能每次变ip都是同一台服务器，可能直接宕机**