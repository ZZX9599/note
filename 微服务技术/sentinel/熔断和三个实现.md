### 熔断和三个实现



**熔断降级是解决雪崩问题的重要手段。其思路是由断路器统计服务调用的异常比例、慢请求比例，如果超出**

**阈值则会熔断该服务。即拦截访问该服务的一切请求；而当服务恢复时，断路器会放行访问该服务的请求。**





**断路器的三个状态：**

![熔断](E:\笔记整理\微服务技术\sentinel\图解\熔断.png)





#### 1：熔断策略-慢调用

#### ![慢调用](E:\笔记整理\微服务技术\sentinel\图解\慢调用.png)



**案例：给Feign的UserClient的查询用户接口设置降级规则，慢调用的RT阈值为50ms，统计时间为1秒**

**最小请求数量为5，失败阈值比例为0.4，熔断时长为5**

**在一秒内，在大于等于5个请求的情况下，有40%的请求响应都超过了50ms，则断开5s，进入一次半开测试**

![测试](E:\笔记整理\微服务技术\sentinel\图解\测试.png)



#### 2：熔断策略-异常比例，异常数



![异常比例](E:\笔记整理\微服务技术\sentinel\图解\异常比例.png)



**给 UserClient的查询用户接口设置降级规则，统计时间为1秒**

**最小请求数量为5，失败阈值比例为0.4，熔断时长为5s**

**我们可以在代码里卖弄手动抛出异常进行测试**





**Sentinel熔断降级的策略有哪些？**

**•慢调用比例：超过指定时长的调用为慢调用，统计单位时长内慢调用的比例，超过阈值则熔断**

**•异常比例：统计单位时长内异常调用的比例，超过阈值则熔断**

**•异常数：统计单位时长内异常调用的次数，超过阈值则熔断**