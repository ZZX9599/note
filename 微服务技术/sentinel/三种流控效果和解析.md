### 三种流控效果和解析

**流控效果是指请求达到流控阈值时应该采取的措施，包括三种：**

**•快速失败：达到阈值后，新的请求会被立即拒绝并抛出FlowException异常。是默认的处理方式。**

**•warm up：预热模式，对超出阈值的请求同样是拒绝并抛出异常。但这种模式阈值会动态变化**

**从一个较小值逐渐增加到最大阈值。**

**•排队等待：让所有的请求按照先后次序排队执行，两个请求的间隔不能小于指定时长**



#### 1：快速失败

**直接抛出异常：com.alibaba.csp.sentinel.slots.block.flow.param.ParamFlowException**



#### 2：warm up，预热模式

**服务器刚启动的时候，效率不高，没那么多的并发量，所以QPS需要慢慢上来**

**warm up也叫预热模式，是应对服务冷启动的一种方案。请求阈值初始值是 threshold / coldFactor，持续指**

**定时长后，逐渐提高到threshold值。而coldFactor的默认值是3.**

**例如，我设置QPS的threshold为10，预热时间为5秒，那么初始阈值就是 10 / 3 ，也就是3**

**然后在5秒后逐渐增长到10.**

**出错的话，和快速启动一样，抛出异常**





#### 3：排队等待

**当请求超过QPS阈值时，快速失败和warm up 会拒绝新的请求并抛出异常。**

**而排队等待则是让所有请求进入一个队列中，然后按照阈值允许的时间间隔依次执行。**

**后来的请求必须等待前面执行完成，如果请求预期的等待时间超出最大时长，则会被拒绝。**



**例如：QPS = 5，意味着每200ms处理一个队列中的请求；timeout = 2000**

**意味着预期等待超过2000ms的请求会被拒绝并抛出异常**

**设置QPS=5，进入队列的第一个请求，就算只消耗了10ms，第二个请求也一样需要200ms才能执行**

**设置等待时间达到上限【也就是前面的等待执行过多】就不会进入队列**

**这个模式的好处：即使有再高的并发量，服务器处理的请求都是平缓的，不会突增突降**





**流控效果有哪些？**

**•快速失败：QPS超过阈值时，拒绝新的请求**

**•warm up： QPS超过阈值时，拒绝新的请求；QPS阈值是逐渐提升的，可以避免冷启动时高并发导致服务宕机。**

**•排队等待：请求会进入队列，按照阈值允许的时间间隔依次执行请求；如果请求预期等待时长大于超时时间，直接拒绝**