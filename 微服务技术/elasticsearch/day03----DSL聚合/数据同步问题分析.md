### 数据同步问题分析



**elasticsearch中的酒店数据来自于mysql数据库，因此mysql数据发生改变时**

**elasticsearch也必须跟着改变，这个就是elasticsearch与mysql之间的数据同步**



**在微服务中，负责酒店管理（操作mysql ）的业务与负责酒店搜索（操作elasticsearch ）的业务**

**可能在两个不同的微服务上，数据同步该如何实现呢？**



#### **方案一：同步调用，可以使用OpenFeign提供远程调用的接口**

![同步方式一](E:\笔记整理\微服务技术\图解\DSL对应关系\同步方式一.png)

**缺点：数据耦合，业务耦合，消耗时间，浪费前面调用者的资源，而且存在雪崩风险**



#### 方案二：异步通知，使用MQ的技术来实现通知，通知完成就结束

![同步方式二](E:\笔记整理\微服务技术\图解\DSL对应关系\同步方式二.png)

**优点：解决了耦合和同步的问题，不需要等待后续的执行，效率提升无需等待**

**缺点：引入了中间件，对MQ消息的可靠性有了更高的要求，操作难度也会变大**





#### 方案三：监听binlog

**什么是binlog?**

**mysql的binlog默认是关闭的，开启之后，每当mysql数据发生变化了，binlog就会变化**

**所以我们可以使用一些中间件来监听其变化，变化之后，立刻通知对应的微服务**

![同步方式三](E:\笔记整理\微服务技术\图解\DSL对应关系\同步方式三.png)

**优点：与hotel-admin一点关系也没有，只依赖于binlog和对应的中间件，完全解除耦合**

**缺点：增加了mysql的压力，同时canal中间件搭建较为复杂**





#### 总结：

**方式一：同步调用**

**•优点：实现简单，粗暴**

**•缺点：业务耦合度高**



**方式二：异步通知**

**•优点：低耦合，实现难度一般**

**•缺点：依赖mq的可靠性**



**方式三：监听binlog**

**•优点：完全解除服务间耦合**

**•缺点：开启binlog增加数据库负担、实现复杂度高**